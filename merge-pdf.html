<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge PDF - Free Tool</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/pdf-lib@1.17.1"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7"></script>
    <style>
        .tool-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .file-input {
            width: 100%;
            padding: 20px;
            border: 2px dashed #667eea;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            background: #f8f9fa;
        }
        
        .merge-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 25px;
            cursor: pointer;
            margin: 20px 0;
        }
        
        .merge-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .back-btn {
            display: inline-block;
            margin-bottom: 20px;
            color: #667eea;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Back to Home</a>
        
        <div class="tool-container">
            <h1>üìÑ Merge PDF Files</h1>
            <p>Select multiple PDF files to merge them into one</p>
            
            <input type="file" id="pdfInput" class="file-input" multiple accept=".pdf">
            
            <div id="fileList"></div>
            
            <button id="mergeBtn" class="merge-btn" onclick="mergePDFs()" disabled>
                Merge PDF Files
            </button>
            
            <div id="result"></div>
        </div>
    </div>

    <script>
        const pdfInput = document.getElementById('pdfInput');
        const mergeBtn = document.getElementById('mergeBtn');
        const fileList = document.getElementById('fileList');
        const resultDiv = document.getElementById('result');

        pdfInput.addEventListener('change', function() {
            fileList.innerHTML = '';
            if (this.files.length > 0) {
                mergeBtn.disabled = false;
                fileList.innerHTML = `<h3>Selected Files (${this.files.length}):</h3>`;
                
                for (let i = 0; i < this.files.length; i++) {
                    fileList.innerHTML += `<p>${i+1}. ${this.files[i].name}</p>`;
                }
            } else {
                mergeBtn.disabled = true;
            }
        });

        async function mergePDFs() {
            const files = pdfInput.files;
            
            if (files.length === 0) {
                alert('Please select at least one PDF file');
                return;
            }

            try {
                mergeBtn.disabled = true;
                mergeBtn.textContent = 'Merging...';
                resultDiv.innerHTML = '<p>‚è≥ Merging PDF files, please wait...</p>';

                const mergedPdf = await PDFLib.PDFDocument.create();
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
                    const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    
                    pages.forEach(page => {
                        mergedPdf.addPage(page);
                    });
                }

                const mergedPdfBytes = await mergedPdf.save();
                
                download(mergedPdfBytes, "merged-document.pdf", "application/pdf");
                
                resultDiv.innerHTML = '<p style="color: green;">‚úÖ PDF files merged successfully! Download started.</p>';
                
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = '<p style="color: red;">‚ùå Error merging PDF files. Please try again.</p>';
            } finally {
                mergeBtn.disabled = false;
                mergeBtn.textContent = 'Merge PDF Files';
            }
        }
    </script>
</body>
</html>
